# Usage with PlatformIO

## Installation
An often more straightforward alternative to the Arduino IDE is the PlatformIO framework. It is integrated well into Visual Studio Code on all platforms and can also be used via a terminal, which is the recommended approach on Linux/Unix systems and is detailed in the following.

Install PlatformIO Core by following the [official instructions](https://docs.platformio.org/en/latest/core/installation/methods/index.html).

If you want to test the library standalone, we recommend cloning the library code:

```bash
git clone git@github.com:Sensirion/arduino-upt-mqtt-client.git
```

Finally, it is possible to run the example by building and flashing it, and then monitoring the device:
```bash
pio run -e basicUsage -t upload && pio device monitor
```

Additional insight into the program's actions can be gained by enabling logging messages, which can be done by utilizing the ```develop``` environment and setting the desired logging level in ```platformio.ini```.

<!-- To install this library (in `~/.platformio/lib`), execute the following command in a terminal.
```bash
pio lib --global install "Sensirion UPT MQTT Client"
```
To test an example (e.g `basicUsage`), use the corresponding platformio environment from the project directory:
```bash
cd ~/.platformio/lib/Sensirion_UPT_MQTT_Client/
```
As of november 2, 2023 platformIO does not correctly convert `.ino` files to `.cpp` files in subdirectories of the project. We must do so manually with the following commands, 
for platformio does not compile .ino files.
```bash
cp examples/basicUsage/basicUsage.ino examples/basicUsage/basicUsage.cpp
pio run -e basicUsage -t upload
```
and start the Serial monitor.
```bash
pio device monitor
``` -->


## Configuration

Configuration of MQTT can be managed over the API. For more details refer to the API guide [here](api_guide.md)

Definitions in ```src/mqtt_cfg.h``` for MQTT certificate and WiFi params, the latter only if WiFi shall be managed by this lib. Insights of the build process can be gained by examining the ```logs/buildlog.log``` file generated by ```pio run```, which contains an environment dump.



The ```pio run``` command also automatically copies the example ```.ino```script file to a ```.cpp``` file to successfully compile.

This library was developed utilizing the [ESP logging library](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/system/log.html). To see info messages, be sure to set the desired verbosity level (see ```platformio.ini```).
